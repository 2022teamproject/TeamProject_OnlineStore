<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
    
<mapper namespace="com.teampj.shop.board.BoardService">

	<resultMap type="com.teampj.shop.board.BoardDTO" id="dto">
		<result property="bnum" column="bnum"/>
		<result property="bcode" column="bcode"/>
		<result property="bname" column="bname"/>
		<result property="bcont" column="bcont"/>
		<result property="pcode" column="pcode"/>
		<result property="bdate" column="bdate"/>
		<result property="btype" column="btype"/>
		<result property="reproot" column="reproot"/>
		<result property="repstep" column="repstep"/>
		<result property="repindent" column="repindent"/>
	</resultMap>

<select id="usereareview" resultMap="dto">
select b.bnum, l.pname as pcode, b.bdate, b.bname, b.bcont from boarddb b left outer join listdb l on (b.pcode = l.pcode) where b.bnum = #{param2} and b.bcode = (select ucode from userdb where userid = #{param1})
</select>

<insert id="userreviewsave">
insert into boarddb select SEQ_boardDB.NEXTVAL, ucode, #{param2}, #{param3}, pcode, sysdate, 2, 2, 0, 0 from orderdb where ocode = #{param1}
</insert>

<select id="userreviewlist" resultMap="dto">
select b.bnum, b.bname, l.pname as pcode, b.bdate from boarddb b left outer join listdb l on (b.pcode = l.pcode) where  b.bcode = (select ucode from userdb where userid = #{param1}) and b.btype = #{param2}
</select>

<delete id="userreviewdel">
delete from boarddb where bnum = #{param2} and bcode = (select ucode from userdb where userid=#{param1})
</delete>

<select id="userreviewupdateget" resultMap="dto">
select b.bnum, l.pname as pcode, b.bdate, b.bname, b.bcont from boarddb b left outer join listdb l on (b.pcode = l.pcode) where b.bnum = #{param2} and b.bcode = (select ucode from userdb where userid = #{param1})
</select>

<update id="userreviewupdateset">
update boarddb set bname = #{param3}, bcont = #{param4} where bnum = #{param2} and bcode = (select ucode from userdb where userid = #{param1})
</update>



</mapper>