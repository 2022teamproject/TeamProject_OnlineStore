<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
    
<mapper namespace="com.teampj.shop.order.OrderService">

	<resultMap type="com.teampj.shop.order.OrderDTO" id="dto">
		<result property="ocode" column="ocode"/>
		<result property="ucode" column="ucode"/>
		<result property="scode" column="scode"/>
		<result property="pcode" column="pcode"/>
		<result property="ocount" column="ocount"/>
		<result property="oaddress" column="oaddress"/>
		<result property="omemo" column="omemo"/>
		<result property="omethod" column="omethod"/>
		<result property="odate" column="odate"/>
		<result property="ostate" column="ostate"/>
		<result property="oshipcode" column="oshipcode"/>
		<result property="oshipstate" column="oshipstate"/>
	</resultMap>
<!-- ocode insert 할 때, 칼럼값을 'O'||LPAD(SEQ_orderDB.NEXTVAL,5,0) -->

<select id="orderlist" resultMap="dto">
select o.ocode, o.ocount, 
		decode (o.ostate,
		        1, '배송전',
		        2, '배송시작',
		        3, '구매확정') as omethod
		, o.odate, l.pname as oshipcode, o.ocharge, nvl(b1.bnum, 0) as oaddress, nvl(b2.bnum, 0) as omemo
		from orderdb o join listdb l on (o.pcode = l.pcode)
		    left outer join userdb u on (o.ucode = u.ucode)
		    left outer join boarddb b1 on (u.ucode = b1.bcode and o.pcode = b1.pcode and b1.btype=2)
            left outer join boarddb b2 on (u.ucode = b2.bcode and o.pcode = b2.pcode and b2.btype=1)
		where (odate between add_months(sysdate, -(#{param2}+3)) and add_months(sysdate, -(#{param2})))
		    and u.userid = #{param1}
</select>

</mapper>